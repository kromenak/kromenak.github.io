<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>G-Engine #5: GK3 Assets Overview - Clark Kromenaker</title>
<meta name=description content="Previous posts in this series have focused on the technical aspects of getting the G-Engine up and running. For this post, I&rsquo;m going to take a short break from writing engine code to instead analyze how GK3 is built. It&rsquo;ll be important to understand this as I move forward and try to recreate it.
As a data-driven game, GK3 makes heavy use of various custom data and file formats. I&rsquo;ll refer to each piece of data as an asset.
A key challenge in this project is understanding what the different asset types are, how they relate to one another, how to parse and load them into memory, and how to make use of them at runtime in a meaningful way. The developers would have documented all this, but much of that is unavailable to me - time for some detective work!
This post focuses on those first two questions: what are the different asset types, and how do they relate to one another? We&rsquo;ll take a look at the various assets, what they do, and the web of relationships between them."><meta name=author content="Clark Kromenaker"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Clark Kromenaker","url":"https:\/\/kromenak.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/kromenak.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/kromenak.github.io\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/kromenak.github.io\/post\/gengine-05-asset-types\/","name":"G engine #5 gk3 assets overview"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Clark Kromenaker"},"headline":"G-Engine #5: GK3 Assets Overview","description":"Previous posts in this series have focused on the technical aspects of getting the G-Engine up and running. For this post, I\u0026rsquo;m going to take a short break from writing engine code to instead analyze how GK3 is built. It\u0026rsquo;ll be important to understand this as I move forward and try to recreate it.\nAs a data-driven game, GK3 makes heavy use of various custom data and file formats. I\u0026rsquo;ll refer to each piece of data as an asset.\nA key challenge in this project is understanding what the different asset types are, how they relate to one another, how to parse and load them into memory, and how to make use of them at runtime in a meaningful way. The developers would have documented all this, but much of that is unavailable to me - time for some detective work!\nThis post focuses on those first two questions: what are the different asset types, and how do they relate to one another? We\u0026rsquo;ll take a look at the various assets, what they do, and the web of relationships between them.\n","inLanguage":"en","wordCount":5681,"datePublished":"2019-09-28T00:00:00","dateModified":"2019-09-28T00:00:00","image":"https:\/\/kromenak.github.io\/img\/avatar-icon.png","keywords":["G-Engine, C\u002b\u002b"],"mainEntityOfPage":"https:\/\/kromenak.github.io\/post\/gengine-05-asset-types\/","publisher":{"@type":"Organization","name":"https:\/\/kromenak.github.io\/","logo":{"@type":"ImageObject","url":"https:\/\/kromenak.github.io\/img\/avatar-icon.png","height":60,"width":60}}}</script><meta property="og:title" content="G-Engine #5: GK3 Assets Overview"><meta property="og:description" content="Previous posts in this series have focused on the technical aspects of getting the G-Engine up and running. For this post, I&rsquo;m going to take a short break from writing engine code to instead analyze how GK3 is built. It&rsquo;ll be important to understand this as I move forward and try to recreate it.
As a data-driven game, GK3 makes heavy use of various custom data and file formats. I&rsquo;ll refer to each piece of data as an asset.
A key challenge in this project is understanding what the different asset types are, how they relate to one another, how to parse and load them into memory, and how to make use of them at runtime in a meaningful way. The developers would have documented all this, but much of that is unavailable to me - time for some detective work!
This post focuses on those first two questions: what are the different asset types, and how do they relate to one another? We&rsquo;ll take a look at the various assets, what they do, and the web of relationships between them."><meta property="og:image" content="https://kromenak.github.io/img/avatar-icon.png"><meta property="og:url" content="https://kromenak.github.io/post/gengine-05-asset-types/"><meta property="og:type" content="website"><meta property="og:site_name" content="Clark Kromenaker"><meta name=twitter:title content="G-Engine #5: GK3 Assets Overview"><meta name=twitter:description content="Previous posts in this series have focused on the technical aspects of getting the G-Engine up and running. For this post, I&rsquo;m going to take a short break from writing engine code to instead â€¦"><meta name=twitter:image content="https://kromenak.github.io/img/avatar-icon.png"><meta name=twitter:card content="summary_large_image"><link href=https://kromenak.github.io/img/favicon.ico rel=icon type=image/x-icon><meta name=generator content="Hugo 0.133.1"><link rel=alternate href=https://kromenak.github.io/index.xml type=application/rss+xml title="Clark Kromenaker"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://kromenak.github.io/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://kromenak.github.io/css/syntax.css><link rel=stylesheet href=https://kromenak.github.io/css/codeblock.css><link rel=stylesheet href=https://kromenak.github.io//css/portfolio.css><link rel=stylesheet href=https://kromenak.github.io//css/misc.css><link rel=stylesheet href=https://kromenak.github.io//css/overrides.css><script src=https://kromenak.github.io//js/darkModeToggle.js></script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://kromenak.github.io/>Clark Kromenaker</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Blog href=/>Blog</a></li><li><a title=Portfolio href=/portfolio>Portfolio</a></li><li><a title=About href=/about>About</a></li><li><a title=Tags href=/tags>Tags</a></li><li class=navlinks-container id=dark-mode-toggle><a href=javascript:toggleColorScheme();><i id=icon-sun class="fas fa-sun"></i>
<i id=icon-moon class="fas fa-moon"></i></a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title="Clark Kromenaker" href=https://kromenak.github.io/><img class=avatar-img src=https://kromenak.github.io/img/avatar-icon.png alt="Clark Kromenaker"></a></div></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>G-Engine #5: GK3 Assets Overview</h1><span class=post-meta><i class=fas></i>Posted on September 28, 2019</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>Previous posts in this series have focused on the technical aspects of getting the G-Engine up and running. For this post, I&rsquo;m going to take a short break from writing engine code to instead analyze how GK3 is built. It&rsquo;ll be important to understand this as I move forward and try to recreate it.</p><p>As a data-driven game, GK3 makes heavy use of various custom data and file formats. I&rsquo;ll refer to each piece of data as an <strong>asset</strong>.</p><p>A key challenge in this project is understanding what the different asset types are, how they relate to one another, how to parse and load them into memory, and how to make use of them at runtime in a meaningful way. The developers would have documented all this, but much of that is unavailable to me - time for some detective work!</p><p>This post focuses on those first two questions: what are the different asset types, and how do they relate to one another? We&rsquo;ll take a look at the various assets, what they do, and the web of relationships between them.</p><h1 id=barn-archives-brn-extension>Barn Archives (.BRN Extension)</h1><p>The average commercial video game will contain thousands of assets for 3D models, image files, sounds, gameplay logic, and other custom data defined by programmers and designers. It&rsquo;s actually uncommon to ship a game with all those assets existing as &ldquo;loose files&rdquo; on the hard drive. It&rsquo;s much more common to combine a bundle of assets into an &ldquo;archive&rdquo; of some sort. There are a couple reasons for this:</p><ul><li>Shipping loose assets would make it easier for players to either modify assets or use them for other purposes</li><li>Loose assets are easier to misplace or accidentally delete, causing the game to malfunction in some way</li><li>There may be limits on the number of simultaneous files you can access at one time when the game is running</li><li>Loading individual files from the hard drive with separate file streams may be slower than either loading a single archive in full or seeking around to load individual parts of the archive</li><li>Lumping assets into archives can be helpful to only load assets needed for a particular part of a game, which assists with memory management</li></ul><p>GK3 stores all its assets in a handful of archive files called &ldquo;Barns.&rdquo; GK3 ships with a total of eight barns:</p><ul><li>ambient.brn</li><li>common.brn</li><li>core.brn</li><li>day1.brn</li><li>day2.brn</li><li>day3.brn</li><li>day23.brn</li><li>day123.brn</li></ul><p>As you might guess, the &ldquo;day1&rdquo; barn contains files used only during &ldquo;day 1&rdquo; in the game, &ldquo;day2&rdquo; has assets only used during &ldquo;day 2&rdquo;, and so on.</p><p>Why are they called &ldquo;barns&rdquo;? Comically, several of the asset types used by the engine are named after animals. In keeping with that theme, someone must have considered that a container holding many types of animals is sometimes called a &ldquo;barn.&rdquo;</p><p>These archives are essentially just giant blobs of binary data. The first X bytes of the blob can be considered a &ldquo;header&rdquo; and &ldquo;table of contents,&rdquo; explaining what assets exist in the archive and what byte offsets each asset exists at. At runtime, we open the archive, read the header data, and then seek to various assets to load them into memory and use them during gameplay.</p><p>All the assets we talk about below are stored in Barn archives on disk. Even though some assets are text-based, they are still part of the binary archive format - we just interpret those particular parts of the archive as text data instead of binary data.</p><h1 id=graphics--3d-assets>Graphics & 3D Assets</h1><p>The bedrock of any 3D game engine will be support for various graphics data formats to enable rendering interesting 3D scenes. GK3 uses a relatively limited set of resources to define renderable geometry and images.</p><h2 id=image-files-bmp-extension>Image Files (.BMP Extension)</h2><p>GK3 makes use of BMP files for 2D image data, or <strong>textures</strong>. You may know BMP as a fairly common image file format.</p><p>BMP files are known to be quite large and &ldquo;uncompressed&rdquo; usually, but the BMP specification actually allows for a variety of different internal data formats. GK3 primarily makes use of two variant BMP formats: a standard 8-bit palettized format, and a non-standard compressed format.</p><h3 id=8-bit-palettized-bmp-files>8-bit Palettized BMP Files</h3><p>This variant matches the documented
<a href=https://en.wikipedia.org/wiki/BMP_file_format#File_structure target=_blank>BMP file format</a> where the file contains a palette of colors (defined in RGBA 32-bit format) and each pixel of the image is stored as an 8-bit index (0-255) into that palette. This limits the number of colors you can use in the image to 256, but it saves a lot of space because each pixel is only 1 byte.</p><p>This format is only used for a few special purposes. The main use is for &ldquo;walker boundary&rdquo; assets, which store the walkable areas in each scene of the game in a texture format - different colors indicate whether spots on the floor are walkable. The game also contains some scripting support for turning on or off certain walkable areas based on the palette indexes associated with certain floor areas in these files.</p><p>The only other use I&rsquo;ve seen is to sometimes hold an alpha channel for an otherwise opaque image. For example, inventory item images are stored as opaque compressed BMP files, but the alpha channel is stored in 8-bit palettized format. In this case, the palette index corresponds to a certain amount of alpha from 0-255.</p><h3 id=compressed-bmp-files>Compressed BMP Files</h3><p>This variant does not follow the documented BMP file format - it is custom. These can be identified by a unique 4-byte identifier at the beginning of the file (0x4D6E3136, or &ldquo;Mn16&rdquo; in ASCII). The &ldquo;16&rdquo; in the identifier refers to the fact that this is a 16-bit (or 2-byte-per-pixel) image format. Each pixel is stored in 16 bits where 5 bits are used for Red/Blue and 6 bits are used for the green channel. This equates to a relatively common &ldquo;RGB565&rdquo; format.</p><p>This format is used for the majority of the game&rsquo;s visual texture assets. So, like 95% of the textures in the game use this format.</p><p>GK3 does not support any image format with an alpha channel. As a result, most of the images in the game are opaque. In situations where we need pixels to be either 100% opaque or 100% transparent, a magenta-based
<a href=https://en.wikipedia.org/wiki/Chroma_key target=_blank>chroma key</a> method is used. If semi-translucent pixels are desired, the only option is to use a separate 8-bit palettized alpha channel texture, as described above.</p><h2 id=bsp-geometry-bsp-extension>BSP Geometry (.BSP Extension)</h2><p>Binary space partitioning is a method to efficiently and correctly render static 3D geometry in games that was commonly used during the 90s and 00s - some notable examples are <em>Doom</em>, <em>Quake</em>, <em>Unreal</em>, and <em>Half-Life</em>. You can still find BSP in some games today, but it is less common than it used to be. Unreal Engine 4 still provides support for BSP mainly as a method of quick level design iteration:
<a href=https://docs.unrealengine.com/en-US/Engine/Actors/Brushes target=_blank>Unreal 4 BSP Docs</a>.</p><p>GK3 uses BSP to render the majority of the static 3D geometry in the game. The primary limitation for BSP is that the 3D geometry is static - it can&rsquo;t be easily repositioned and it can&rsquo;t animate. As a result, BSP is commonly used for things like buildings, terrain, foliage, furniture, and various unmoving props of any kind.</p><p>BSP assets are binary. They mainly contain 3D geometry data used for rendering, but they also contain some relevant gameplay data, such as the &ldquo;names&rdquo; of certain objects in the scene. For example, if all the polygons in the BSP that make up a bench may have the name &ldquo;Bench&rdquo;. Elsewhere, game designers define &ldquo;Bench&rdquo; as a thing you can interact with.</p><p>A BSP asset contains one or more &ldquo;objects.&rdquo; Each object consists of one or more surfaces, and each surface consists of one or more polygons. The surface also defines textures, uv scale/offset, and other attributes. BSP geometry also contains some lighting data, but I&rsquo;m not sure whether this is actually used at runtime. GK3 has some basic lighting support, but it seems much simpler than what is contained within the BSP.</p><p>BSP assets are mainly referenced from scene assets to define the overall look of a particular location in the game. During gameplay, BSP is queried frequently for things like floor height and checking whether a user clicked on a particular object in the geometry for interaction purposes. The BSP asset used for a scene is either explicitly defined in a scene asset, or if the scene asset doesn&rsquo;t specify a BSP to use, it is implied to be the BSP with the same name as the scene file.</p><p>BSP assets reference texture assets to define what texture a surface should use.</p><h2 id=mul-files-mul-extension>MUL Files (.MUL Extension)</h2><p>MUL files contain lighting data for associated BSP geometry. This allows a single piece of BSP geometry to have different lightmaps. For example, one MUL file may light a scene as daytime, while the other lights it as a night scene.</p><p>GK3 has several locations that are visited at different times of day. A location with particular BSP geometry is sometimes visited in the morning, afternoon, evening, or night. Rather than duplicate BSP assets that differ only by their lighting data, storing the lighting data in a separate asset allows the same BSP to be used in conjunction with multiple lighting variations.</p><p>The binary data in a MUL file is simply a set of BMP texture assets, packed tightly in memory into a single file. There is one texture per surface in the associated BSP geometry.</p><p>To light the scene at runtime, each surface in the BSP simply retrieves the lightmap from the MUL file that&rsquo;s at the same index. For example, surface index 9 in the BSP uses lightmap index 9 from the MUL file.</p><p>They are referenced as part of scene assets.</p><h2 id=3d-models-mod-extension>3D Models (.MOD Extension)</h2><p>GK3 uses a custom 3D model format with a <code>.MOD</code> extension (for &ldquo;model&rdquo;, I presume). The files are binary and fairly complicated - some portions of the format I have not yet figured out.</p><p>Each GK3 model consists of one or more &ldquo;meshes.&rdquo; Each mesh consists of one or more &ldquo;submeshes.&rdquo; Each submesh consists of vertices, indexes (for rendering indexed geometry), uv coordinates (for texture mapping), normals (for lighting) and a texture name. The texture name correlates to a BMP file that should be used as the texture when rendering the submesh.</p><p>The format also supports LOD (level of detail), though this isn&rsquo;t used frequently. There are additionally some mysterious &ldquo;MODX/GRPX&rdquo; blocks in the binary files - these seem like possibly additional metadata or additional vertex attributes for the model, but I haven&rsquo;t yet deciphered that.</p><p>GK3 models were authored in 3D Studio Max and exported to the custom MOD format. 3D Studio Max files are exported with the z-axis up and x/y-axes for the floor. GK3 uses y-axis up and x/z for the floor, so some conversion is required when importing the MOD files. Usually, this sort of conversion would occur at build-time, but for whatever reason, that isn&rsquo;t generally the case here. However, it&rsquo;s easy to flip these values when reading in the file.</p><p>Models can be used to render static geometry, but they are usually used for dynamic or animating 3D objects. If you need an object to play an animation or move around the scene, you need to use a model instead of BSP geometry.</p><p>GK3 models are referenced in many scene assets (SIF and SCN assets), since a particular scene of the game will often be made up of one or more 3D models. GK3 also uses vertex-based animation (as opposed to skeletal animation), so vertex animation files (ACT assets) reference specific MOD files.</p><p>Each submesh in a model specifies the texture asset that should be used when rendering.</p><h1 id=animation-assets>Animation Assets</h1><p>When you think of an animation in games, you probably think of either a traditional 2D &ldquo;cell-based&rdquo; animation or a 3D model animated via a skeleton or vertex animation. However, GK3 also has a higher-level animation construct that provides a way to &ldquo;direct&rdquo; or &ldquo;coordinate&rdquo; multiple animation-related actions and synchronize them with other effects, like sound.</p><h2 id=animation-files-anm-extension>Animation Files (.ANM Extension)</h2><p>Animation files are text-based definitions of how multiple in-game effects coordinate with one another. When you want to play an animation in GK3, you almost always specify a particular animation file to use.</p><p>Animation files are used to coordinate or direct multiple scene objects during an animation. For example, a &ldquo;walk&rdquo; animation file specifies that a model should play an animation and that certain frames should play footstep sounds. A cutscene animation might tell multiple models to play animations, change the camera angle, play multiple lines of VO, modify the texture on a model, and change a character&rsquo;s facial expression.</p><p>Animation files are referenced any place an animation might need to be played - script files, noun/verb/case files, etc. Therefore, they are one of the most frequently used asset types.</p><p>Animation files can reference many other assets: vertex animation files, textures, BSP object names, sound file names, etc. There is a fairly extensive list of supported features: play vertex animations, swap scene textures, swap scene object visibility, swap model textures, swap model visibility, play 3D sounds, play soundtrack files, move the camera, change facial features, etc.</p><h2 id=mother-of-all-animations-files-mom-extension>&ldquo;Mother of all Animations&rdquo; Files (.MOM Extension)</h2><p>These files seem to be exactly the same as normal animation files. They are both text files and they contain the same syntax and supported keywords. A piece of documentation refers to these as &ldquo;Mother of all Animations&rdquo; files!</p><p>It&rsquo;s unclear why the game needed these in addition to the standard animation files. One trend I see is that MOM files tend to define more complicated animation sequences. Perhaps they were treated differently at runtime?</p><h2 id=vertex-animation-files-act-extension>Vertex Animation Files (.ACT Extension)</h2><p>In
<a href=https://www.gamasutra.com/view/feature/131536/postmortem_sierra_studios_.php target=_blank>the GK3 postmortem</a>, Scott Bilas laments the decision to use vertex animations, rather than convert everything to skeletal animations when it became apparent they were a better choice. Since I&rsquo;m trying to re-implement GK3&rsquo;s animations, I feel his pain!</p><p>There are annoyances with this approach that the postmortem enumerates: each animation only works on a single model. If the model is changed, the animation needs to be redone. It requires more storage and is more computationally expensive to use. From a workflow perspective, imagine that you want to improve a model in the game, but doing so means EVERY animation that model uses also needs to be redone!</p><p>A vertex animation file is a binary asset that defines one or more frames of animation for a model. Each frame can specify data for each submesh in the model. The data defined for the submesh could be positions or position deltas for individual vertices, an updated translation/rotation/scale, or updated bounding boxes.</p><p>Vertex data is heavily compressed. Usually, the first frame defines full 3D coordinates for each vertex. Subsequent frames define position deltas that are heavily compressed to save space. If a vertex doesn&rsquo;t update on a frame, its data is omitted.</p><p>Vertex animation files are mostly referenced by animation files. They are usually easy to distinguish from other assets because they tend to be prefixed with the target model&rsquo;s name (e.g. gab_walk).</p><p>Vertex animation files contain a reference to the name of the 3D model the animation is meant for. Attempting to play a vertex animation on the incorrect 3D model will probably not look correct at all!</p><h2 id=sequence-files-seq-extension>Sequence Files (.SEQ Extension)</h2><p>Sequence files define a sequence of elements, with the elements being either animations or textures. I believe the idea is to play a sequence of animations or textures in order.</p><p>These are rarely used in the game. The only instance I&rsquo;ve found so far is to animate the text on the timeblock change screens.</p><h1 id=logic-assets>Logic Assets</h1><p>By the time GK3 was made, Sierra had been in the adventure game business for many years. Their prior AGI and SCI engines implemented scripting languages to avoid hardcoding gameplay logic in the core engine.</p><p>Fortunately, GK3 also takes this approach - the vast majority of the game&rsquo;s logic is not in the game&rsquo;s executable, but in various bundled assets.</p><h2 id=sheep-script-files-shp-extension>Sheep Script Files (.SHP Extension)</h2><p>Sheep Script files are binary AND text assets that can be executed using GK3&rsquo;s internal scripting language system, Sheep. The majority of the game&rsquo;s logic and functionality is defined using this scripting language. This is extremely cool - expect a blog post in the future exploring this in much more detail!</p><p>Sheep is a relatively simple scripting language that has basic support for user-defined variables of int/float/string, user-defined functions, and system functions. The majority of sheep script operations involve calling system functions to do various things (move actors, play animations, play sounds/VO, etc).</p><p>Many of the Sheep assets in the game are in a binary format, but some Sheep scripts exist in text format, such as those found in SIF and NVC files. It is also possible to execute Sheep code from the in-game console. As a result, the engine must be able to execute &ldquo;compiled&rdquo; Sheep byte code, and it must also be able to compile Sheep scripts &ldquo;on the fly&rdquo; to byte code for execution. Fun!</p><p>Sheep assets are referenced in plenty of places: SIFs, NVCs, and GAS files to name a few. Whenever we want the game to do some arbitrary action or check some arbitrary conditions, this is usually done with a snippet of Sheep script.</p><p>Sheep scripts do not reference assets directly, but calls to system functions often involve specifying the name of a model, texture, animation, sound file, etc. It&rsquo;s perfectly possible for Sheep files to try to reference invalid asset names, so that&rsquo;s got to be accounted for.</p><h2 id=gas-files-gas-extension>GAS Files (.GAS Extension)</h2><p>The documentation refers to this as the &ldquo;G-Engine Auto Scripting Language.&rdquo; When you look at GAS files compared to Sheep files, you can see a world where maybe only Sheep files were needed - does a game really need TWO scripting languages!?</p><p>Well, technically, GAS files are not truly scripts. They are relatively simply text-based assets that contain one command per line and extremely simple control structures. The main commands in GAS are to play an animation or walk to a spot.</p><p>The idea behind GAS script files is to control what an actor does when not being actively commanded to perform actions by the player or Sheep script files. If an actor is just standing in a room and not being interacted with, it&rsquo;d look strange if they did absolutely nothing. GAS script execution allows such an actor to play idle &ldquo;fidget&rdquo; animations or follow some path to walk around.</p><p>GAS scripts are also used for the dialogue system - generally, an actor will have three GAS scripts that it alternates between: idle, talk, and listen. When engaged in dialogue, actors will play their talk scripts while talking and listen scripts while someone else is talking.</p><p>GAS scripts are primarily referenced in Scene Initialization Files (SIFs), where they are used to declare what GAS scripts an actor should use. They are also referenced in Sheep files to change an actor&rsquo;s GAS script under certain circumstances.</p><p>GAS scripts mostly just reference animation files, but they occasionally reference position markers that are defined in Scene Initialization Files (SIFs).</p><h1 id=scene-assets>Scene Assets</h1><p>Many video games are level-based or have discrete locations. Games and game engines have a variety of names for this concept: levels, courses, maps, rooms, locations, or scenes to name a few.</p><p>GK3 fits pretty nicely into this mold. Gameplay is split into discrete locations that you visit to explore and perform actions (e.g. Hotel Room 25, Hotel Lobby, Church Interior, Graveyard, Train Station).</p><p>One interesting requirement in GK3 is that scenes are not totally static. For one, you can visit a particular location during multiple &ldquo;timeblocks.&rdquo; Visiting a location at 10AM vs. 8PM will graphically look different, just due to lighting and skybox requirements. But locations also tend to behave differently at different times: NPCs exist in one scene at one time and are elsewhere later on. A car might be in a parking lot in the morning, but gone later.</p><p>GK3 sometimes refers to these as &ldquo;scenes,&rdquo; sometimes as &ldquo;locations.&rdquo;</p><h2 id=scene-initialization-sif-files>Scene Initialization (SIF) Files</h2><p>When you enter a new scene in GK3, the appropriate scene initialization file(s) (or SIFs, for short) are loaded based on the location and timeblock the player is currently in. For example:</p><ul><li>R25.SIF is loaded when you are at the location &ldquo;R25&rdquo; (which is Gabe&rsquo;s room in the game)</li><li>R25306P.SIF is loaded when you are at the location &ldquo;R25&rdquo; on Day 3 at 6PM</li></ul><p>The idea is that the &ldquo;general&rdquo; SIF is always loaded when you are at a location, but a &ldquo;specific&rdquo; SIF (for a specific timeblock) can also be <em>optionally</em> defined. If the &ldquo;specific&rdquo; asset does not exist, it is simply not loaded. The purpose of the specific SIF is to provide additions, alternatives, and overrides for the scene that only apply in that specific timeblock.</p><p>SIF files are fairly complicated text files in
<a href=https://en.wikipedia.org/wiki/INI_file target=_blank>INI format</a> (with some customizations). Basically, anything that needs to be defined and loaded for a scene is specified in this file. For example:</p><ul><li>Which scene file to use (which in turn defines the lighting and BSP to use)</li><li>A global light position</li><li>Camera movement boundaries and actor walker boundaries</li><li>All &ldquo;actors&rdquo; to load. Actors are essentially humanoids and some animals. The model to use, noun, start position, and GAS file to use are specified</li><li>All &ldquo;models&rdquo; to load. Models are potentially dynamic 3D objects, such as a fountain, motorcycle, or door. The model to use, noun, position, and type are specified. Type indicates whether the model is part of the BSP asset or loaded separately as a 3D model asset</li><li>Meaningful positions are defined with X/Y/Z coordinates, orientations, and identifiers</li><li>Meaningful camera positions are defined with X/Y/Z coordinates, orientations, and identifiers</li><li>3D regions and trigger volumes are defined and named</li><li>Soundtrack files to play are specified</li><li>NVC files to use are specified</li></ul><p>One interesting deviation from the INI format is the ability to specify a &ldquo;condition,&rdquo; using Sheep script, for any block of data in the SIF file. The result is that certain declarations for what models to load or what scene files to use can change depending on gameplay variables.</p><p>SIF files are not really referenced by other assets. The correct ones to load are derived from the specified location and timeblock.</p><p>SIF files reference A LOT of other assets. They reference models, BSP, soundtracks, GAS files, Sheep files, and NVC files.</p><h2 id=scene-files-scn-extension>Scene Files (.SCN Extension)</h2><p>Scene files are relatively simple text files that seem somewhat superfluous, though they contain some relevant data.</p><p>The most useful thing this file does is identify the BSP file to use. If no BSP is specified in this file, it is assumed that we should just use the BSP that has the same name as the scene file asset. The name of the scene file asset also matches the MUL file we should use.</p><p>Beyond that, the scene file contains definitions for lights and a list of object names in the BSP. Thus far, neither of these seem useful.</p><p>Scene files are referenced from scene initialization files (SIFs).</p><h2 id=nounverbcase-files-nvc-extension>Noun/Verb/Case Files (.NVC Extension)</h2><p>Noun/verb/case files (or NVC files) are really the meat of defining interactivity within a particular scene. These are text files that define:</p><ul><li>What &ldquo;nouns&rdquo; are interactive? The mapping between nouns and 3D objects is defined in scene initialization files.</li><li>What verbs can you perform on the object? These tend to be like &ldquo;LOOK&rdquo;, &ldquo;OPEN&rdquo;, &ldquo;CLOSE&rdquo;, etc.</li><li>Under what cases is the verb valid for the noun? Some interactions are always available, others are only available for Gabe or Grace, and others are only available if arbitrary conditions (defined in Sheep scripting language) are met.</li><li>When you perform the verb on the noun, what action is performed? Also defined in Sheep scripting language.</li></ul><p>A typical line from one of these files looks like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>CANOE_PAINTING, LOOK, GRACE_ALL, approach=WalkToSee, target=r25pic01, script={wait StartVoiceOver(&#34;1LLJ644QS1&#34;,2);}
</span></span></code></pre></div><p>Some conditions (like GRACE_ALL) are globally defined. But it is also possible to define custom cases, such as this one:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>DRESSER_OPEN = {(GetNounVerbCount(&#34;DRESSER&#34;, &#34;OPEN&#34;) == 1) &amp;&amp; IsCurrentEgo(&#34;Gabriel&#34;)}
</span></span></code></pre></div><p>You can only perform an action in a scene if it is defined in an NVC file. NVC files are loaded in scene initialization files, and they are often conditionally loaded depending on the particular timeblock that is currently active.</p><h1 id=audio-assets>Audio Assets</h1><p>Beyond the obvious sound files, GK3 also defines a couple novel asset types related to audio.</p><h2 id=musicsfx-files-wav-extension>Music/SFX Files (.WAV Extension)</h2><p>Most sound effects in GK3 have a .WAV extension, which might lead you to believe they are uncompressed WAV files. However, they are actually in compressed MP3 format. Despite the lack of MP3 extension, the WAV file format is perfectly capable of storing MP3 compressed audio data.</p><p>Audio files don&rsquo;t reference other assets, but they are referenced frequently - pretty much anywhere you&rsquo;d want to play a sound or music file.</p><h2 id=vo-files-random-extension>VO Files (Random Extension)</h2><p>There is another type of audio file in GK3 that is, at first, a bit mystifying. Anytime a script specifies some character voice-over to play, they specify a filename like &ldquo;A0144J44.N61&rdquo;.</p><p>For some reason, all VO audio files are named rather obscurely with random letters and numbers. The documentation even sometimes refers to these as &ldquo;license plates.&rdquo;</p><p>I don&rsquo;t know the reasoning for this naming convention, but these files are still WAV files, just with different extensions. The distinction is just that these always play VO.</p><h2 id=soundtrack-files-stk-extension>Soundtrack Files (.STK Extension)</h2><p>Music in GK3 is not usually defined using minutes-long MP3 files. Instead, to make the music feel less repetitive and more varied, the music for a location tends to be separated into multiple music clips that can be mixed-and-matched to provide the ambient background music.</p><p>To achieve this, the game uses a &ldquo;soundtrack&rdquo; asset type that contains data in INI format. Using a couple simple keywords, it defines orderings for each chunk of music, a randomized wait time between chunks, and potentially even randomization of the music chunks themselves.</p><p>Soundtrack files only reference audio files.</p><p>Soundtrack files are primarily referenced in scene initialization (SIF) files. They can also be referenced by animations or script files to change the soundtrack suddenly as part of some gameplay event.</p><h2 id=dialogue-files-yak-extension>Dialogue Files (.YAK Extension)</h2><p>Subtitles for spoken word in movies or video games doesn&rsquo;t seem complicated, but when you think about it, somebody probably needs to manually parse the speech to text AND synchronize it with the audio. That is the case in GK3.</p><p>YAK files define the subtitles for <em>every piece</em> of spoken dialogue in the game. In the case of a cutscene or multiple lines of dialogue, they also specify the pacing of those subtitles so that a subtitle only appears when the audio changes.</p><p>Most YAK files have names that correlate to the &ldquo;license plates&rdquo; used to name VO files. The correlation is: when you play a VO file, lookup the YAK file with the same name! YAK file names are usually prefixed with the letter &lsquo;E&rsquo; - I suspect this was some future-proofing for localization, but the game was never localized.</p><h1 id=ui-assets>UI Assets</h1><p>The UI in GK3 is fairly simple. It feels like UI was definitely not the focus during development - more of a &ldquo;just implement what&rsquo;s needed&rdquo; than a &ldquo;let&rsquo;s implement a full framework&rdquo; sort of thing.</p><h2 id=ui-definition-files-txt-extension>UI Definition Files (.TXT Extension)</h2><p>These are relatively piecemeal TXT files that contain definitions for particular UIs in the game. For example, a file &ldquo;RC_LAYOUT.TXT&rdquo; defines the layout and behavior of the options menu.</p><p>The use of these files in the game must be hardcoded - I don&rsquo;t see references to them elsewhere. The format of the files are also very specific to each screen. So, I suspect there were specific C++ files for each UI definition, and the C++ file would read in what it needed from the data.</p><p>These files tend to primarily reference image files for things like buttons and other graphical elements.</p><h2 id=cursor-files-cur-extension>Cursor Files (.CUR Extension)</h2><p>GK3 uses a couple different cursors: the normal arrow cursor, a highlighted arrow cursor, and a loading cursor come to mind.</p><p>These cursors are defined as simple text files in INI format. The name of the asset usually implies the texture to be used for the cursor.</p><p>Some cursors are animated - in this case, the INI format specifies a frame count and frame rate. It is assumed that the cursor texture&rsquo;s width is divisible by the frame count, and that all the frames are in that one texture.</p><h2 id=font-files-fon-extension>Font Files (.FON Extension)</h2><p>GK3 uses only image-based fonts. Many fonts are used throughout the game, actually - subtitles of varying colors, UI text, console text, etc.</p><p>A font is defined using a text file in INI format. The image containing the font is implied from the font asset name, unless the font asset explicitly specifies an image to use.</p><p>The font asset defines in a simple ordered list which language character correlates to each glyph in the texture. Some fonts do have &ldquo;monospace&rdquo; glyphs, where each glyph is exactly the same size, but that isn&rsquo;t a requirement. In the case that a texture has glyphs of different widths and heights, this is signified using particular pixel colors in the font texture. Pretty complicated to parse and use!</p><h2 id=tooltip-files-tip-extension>Tooltip Files (.TIP Extension)</h2><p>There&rsquo;s only one of these in the game, and I think it&rsquo;s only used with debug tools. It&rsquo;s basically what you&rsquo;d expect: a little box with some helpful text in it that only appears if you hover over something with your mouse for awhile.</p><h2 id=browser-files-html-extension>Browser Files (.HTML Extension)</h2><p>Wait, why does this game need HTML files!? In GK3, the biggest puzzle in the game involves Grace researching and solving a massive riddle to find a buried treasure. To do this, she uses a laptop system called SIDNEY that contains a faux-internet experience, where you can search for topics and follow links between topics.</p><p>Since this experience behaves just like a basic internet browser, the developers must have thought simply using HTML would be a good way to go.</p><p>The HTML system is pretty feature rich: it can display paragraphs, text alignment, body vs. header text, inline images, links to other documents, etc.</p><h1 id=misc-text-assets>Misc Text Assets</h1><p>Finally, GK3 uses a number of text assets for various miscellaneous purposes. In these cases, it&rsquo;s pretty clear that the game just needed a one-off data file to define one thing or another.</p><h2 id=character-definitions>Character Definitions</h2><p>All characters in the game are defined in two text files: CHARACTERS.TXT and FACES.TXT.</p><p>CHARACTERS.TXT mainly defines various traits of the character in-game. I suspect many of the fields may not actually be used. But two that are quite helpful are: the model to use for the character, and the shoe type (used for footstep logic).</p><p>FACES.TXT defines all the traits of a characters face. This includes face texture, default eye colors, blink frequencies, frequency of eye jitter, offsets into face texture for eye/mouth placement, etc.</p><h2 id=footstep-definitions>Footstep Definitions</h2><p>GK3 contains a system for playing footstep or &ldquo;footscuff&rdquo; sounds based on a character&rsquo;s shoe type and the floor type.</p><p>FLOORMAP.TXT maps specific textures on floors to a floor type. For example, 20-something textures in the game are designated as &ldquo;carpet&rdquo; floor type.</p><p>FOOTSTEPS.TXT and FOOTSCUFFS.TXT define lists of sound effects to use for various shoe types on various floor types. Lists are used so that multiple sounds can be randomized.</p><h2 id=verb-definitions>Verb Definitions</h2><p>GK3&rsquo;s noun/verb/case files define verbs that you can use to interact with objects in the game world. The file VERBS.TXT maps verbs to UI images representing that verb.</p><p>For example, the <code>LOOK</code> verb may be mapped to an image of an eyeball.</p><h2 id=inventory-definitions>Inventory Definitions</h2><p>The file INVENTORYSPRITES.TXT maps inventory item names to textures used to represent them when they&rsquo;re in your inventory.</p><h2 id=localization-resources>Localization Resources</h2><p>Files called ESTRINGS.TXT and KEYBOARD.TXT seem to provide mappings from localization keys to values in English. It appears that this was meant for when the game was localized, but it never was!</p><h2 id=sidney-definitions>SIDNEY Definitions</h2><p>As described above, one of the puzzles in the game involves heavy use of a fictional computer system called SIDNEY. To implement this interface, the game uses a number of piecemeal data files.</p><p>ESIDNEY.TXT and ESIDNEYEMAIL.TXT provide mappings from keys to values for the computer&rsquo;s interface and all emails received during the game. Again, seems meant to be localized, but never was.</p><p>SIDNEYDIALOG.TXT defines how visiting certain pages in the in-game browser will trigger in-game events under certain conditions. For example, a part of the puzzle may be to figure out the right thing to search for. Once you find the correct page, it triggers a bit of dialogue from Grace and you get some points.</p><p>SIDSEARCH.TXT maps search terms to specific web pages. This mainly provides some leeway when searching for topics, so you don&rsquo;t always have to get the exact term right.</p><h2 id=binoculars-definition>Binoculars Definition</h2><p>One GK3 mechanic allows you to use a pair of binoculars from certain outdoor locations to see what characters are doing in other locations.</p><p>BINOCS.TXT defines where this feature can be activated and what happens in each instance when you do it.</p><h2 id=gps-definition>GPS Definition</h2><p>There are maybe 2-4 times during the game where Grace uses a GPS to determine the exact spot she should dig to find something buried underground.</p><p>GPS.TXT defines the gameplay aspects of this mechanic. When using the GPS at certain locations, it defines what positions in the scene you need to go to in order to &ldquo;solve&rdquo; the GPS puzzle.</p><p>GPS_VISUAL_INTERFACE_SPEC.TXT defines how the system works - just documentation!</p><h1 id=conclusion>Conclusion</h1><p>As you can see, GK3 makes use of a wide variety of assets to achieve its gameplay goals. As I try to build an engine that recreates that gameplay experience, a huge challenge is simply understanding how all the pieces fit together.</p><p>Through careful investigation, we now have a pretty good idea as to the breadth of asset types, what they&rsquo;re used for, and how they relate to one another.</p><p>Future posts in this series will focus on the challenges associated with parsing and using each of these asset types in G-Engine.</p><div class=blog-tags><a href=https://kromenak.github.io//tags/g-engine/>G-Engine</a>&nbsp;
<a href=https://kromenak.github.io//tags/c++/>C++</a>&nbsp;</div></article><ul class="pager blog-pager"><li class=previous><a href=https://kromenak.github.io/post/csharp-structs/ data-toggle=tooltip data-placement=top title="Saving Memory with C# Structs">&larr; Previous Post</a></li><li class=next><a href=https://kromenak.github.io/post/gengine-06-math/ data-toggle=tooltip data-placement=top title="G-Engine #6: Math Library">Next Post &rarr;</a></li></ul><div class=disqus-comments><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//clarkkromenaker.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=mailto:kromenak@gmail.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/kromenak title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://linkedin.com/in/clarkkromenaker title=LinkedIn><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a href title=RSS><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted">Clark Kromenaker
&nbsp;&bull;&nbsp;&copy;
2024</p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Powered by Hugo v0.133.1</a> &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous></script><script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://kromenak.github.io/js/main.js></script><script>renderMathInElement(document.body)</script></body></html>
<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Loading Shared Libraries on Linux - Clark Kromenaker</title>
<meta name=description content="About three years ago, I wrote 
a post about wrangling dynamic/shared libraries for Mac applications. I recently faced the same challenge on Linux, so I figured I&rsquo;d write a follow up.
If you&rsquo;re new to dealing with shared libraries, I&rsquo;d recommend reviewing the previous post first - it covers some fundamentals that I won&rsquo;t rehash here. Linux and Mac handle dynamic libraries in similar ways - but as you might guess, the tools used and some details vary."><meta name=author content="Clark Kromenaker"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Clark Kromenaker","url":"https:\/\/kromenak.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/kromenak.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/kromenak.github.io\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/kromenak.github.io\/post\/library-dynamic-loading-linux\/","name":"Loading shared libraries on linux"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Clark Kromenaker"},"headline":"Loading Shared Libraries on Linux","description":"About three years ago, I wrote a post about wrangling dynamic\/shared libraries for Mac applications. I recently faced the same challenge on Linux, so I figured I\u0026rsquo;d write a follow up.\nIf you\u0026rsquo;re new to dealing with shared libraries, I\u0026rsquo;d recommend reviewing the previous post first - it covers some fundamentals that I won\u0026rsquo;t rehash here. Linux and Mac handle dynamic libraries in similar ways - but as you might guess, the tools used and some details vary.\n","inLanguage":"en","wordCount":1288,"datePublished":"2024-03-30T00:00:00","dateModified":"2024-03-30T00:00:00","image":"https:\/\/kromenak.github.io\/img\/avatar-icon.png","keywords":["Linux, Build, Libraries"],"mainEntityOfPage":"https:\/\/kromenak.github.io\/post\/library-dynamic-loading-linux\/","publisher":{"@type":"Organization","name":"https:\/\/kromenak.github.io\/","logo":{"@type":"ImageObject","url":"https:\/\/kromenak.github.io\/img\/avatar-icon.png","height":60,"width":60}}}</script><meta property="og:title" content="Loading Shared Libraries on Linux"><meta property="og:description" content="About three years ago, I wrote 
a post about wrangling dynamic/shared libraries for Mac applications. I recently faced the same challenge on Linux, so I figured I&rsquo;d write a follow up.
If you&rsquo;re new to dealing with shared libraries, I&rsquo;d recommend reviewing the previous post first - it covers some fundamentals that I won&rsquo;t rehash here. Linux and Mac handle dynamic libraries in similar ways - but as you might guess, the tools used and some details vary."><meta property="og:image" content="https://kromenak.github.io/img/avatar-icon.png"><meta property="og:url" content="https://kromenak.github.io/post/library-dynamic-loading-linux/"><meta property="og:type" content="website"><meta property="og:site_name" content="Clark Kromenaker"><meta name=twitter:title content="Loading Shared Libraries on Linux"><meta name=twitter:description content="About three years ago, I wrote 
a post about wrangling dynamic/shared libraries for Mac applications. I recently faced the same challenge on Linux, so I figured I&rsquo;d write a follow up.
If â€¦"><meta name=twitter:image content="https://kromenak.github.io/img/avatar-icon.png"><meta name=twitter:card content="summary_large_image"><link href=https://kromenak.github.io/img/favicon.ico rel=icon type=image/x-icon><meta name=generator content="Hugo 0.133.1"><link rel=alternate href=https://kromenak.github.io/index.xml type=application/rss+xml title="Clark Kromenaker"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://kromenak.github.io/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://kromenak.github.io/css/syntax.css><link rel=stylesheet href=https://kromenak.github.io/css/codeblock.css><link rel=stylesheet href=https://kromenak.github.io//css/portfolio.css><link rel=stylesheet href=https://kromenak.github.io//css/misc.css><link rel=stylesheet href=https://kromenak.github.io//css/overrides.css><script src=https://kromenak.github.io//js/darkModeToggle.js></script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://kromenak.github.io/>Clark Kromenaker</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Blog href=/>Blog</a></li><li><a title=Portfolio href=/portfolio>Portfolio</a></li><li><a title=About href=/about>About</a></li><li><a title=Tags href=/tags>Tags</a></li><li class=navlinks-container id=dark-mode-toggle><a href=javascript:toggleColorScheme();><i id=icon-sun class="fas fa-sun"></i>
<i id=icon-moon class="fas fa-moon"></i></a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title="Clark Kromenaker" href=https://kromenak.github.io/><img class=avatar-img src=https://kromenak.github.io/img/avatar-icon.png alt="Clark Kromenaker"></a></div></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Loading Shared Libraries on Linux</h1><span class=post-meta><i class=fas></i>Posted on March 30, 2024</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>About three years ago, I wrote
<a href=/post/library-dynamic-loading-mac>a post</a> about wrangling dynamic/shared libraries for Mac applications. I recently faced the same challenge on Linux, so I figured I&rsquo;d write a follow up.</p><p>If you&rsquo;re new to dealing with shared libraries, I&rsquo;d recommend reviewing the previous post first - it covers some fundamentals that I won&rsquo;t rehash here. Linux and Mac handle dynamic libraries in similar ways - but as you might guess, the tools used and some details vary.</p><h1 id=how-shared-libraries-work>How Shared Libraries Work</h1><p>&ldquo;Dynamic&rdquo; and &ldquo;shared&rdquo; libraries are different names for the same thing. On Linux, the preferred term seems to be &ldquo;shared&rdquo;, so that&rsquo;s what I&rsquo;ll use in the rest of this post.</p><p>A shared library file represents compiled code that is distributed separately from your executable. On Linux, shared libraries are easily recognizable by their <code>.so</code> file extension.</p><p>Because a shared library is a separate file, the executable needs to load it at runtime before it can be used. While there are mechanisms for a programmer to do this manually, it&rsquo;s also common for the &ldquo;loader&rdquo; to automatically load required shared libraries when starting an executable.</p><p>The problem with shared libraries on any platform is that they might not be present when you run the program. If that happens, you get an error message, and the program cannot run.</p><h1 id=how-shared-libraries-are-located>How Shared Libraries are Located</h1><p>The executable contains an embedded list of shared libraries required to run. Only the name of the file is stored. The executable loader then searches an ordered list of paths to find a shared library with that name:</p><ol><li>The executable itself contains an embedded list of search paths for shared libraries. This is called the &ldquo;rpath&rdquo; or &ldquo;run path&rdquo;. Each path in this list is searched in turn.</li><li>As a fallback, the system provides a list of search paths at <code>/etc/ld.so.conf</code>. These are searched only if the library wasn&rsquo;t found in the previous step. Each path in the list is searched in turn.</li></ol><p>And that&rsquo;s it! If a shared library with the searched for name is found, it is used. If the shared library isn&rsquo;t found on any of those paths, you get an error, such as this one on Ubuntu:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>EXE_NAME: error <span class=k>while</span> loading shared libraries: LIB_NAME: cannot open shared object file: No such file or directory
</span></span></code></pre></div><p>Your goal is to have an executable whose list of embedded shared library filenames are either on a search path you specify via the &ldquo;rpath&rdquo;, OR are on a search path provided by the system. The former is usually meant for libraries specific to your application while the latter is meant for libraries that are known to be preinstalled on most/all Linux machines.</p><h1 id=viewing-an-executables-dependencies>Viewing an Executable&rsquo;s Dependencies</h1><p>The list of shared libraries required by an executable can be viewed with the <code>readelf</code> tool:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>readelf -d EXE_PATH <span class=p>|</span> grep <span class=s1>&#39;NEEDED&#39;</span>
</span></span></code></pre></div><p>The <code>-d</code> flag prints out the executable&rsquo;s shared library info. Using the <code>grep</code> command is optional and simply filters the output to only show the shared libraries to be loaded (each has the &ldquo;NEEDED&rdquo; keyword next to it).</p><p>Here&rsquo;s example output from my game engine project:</p><pre tabindex=0><code>0x0000000000000001 (NEEDED) Shared library: [libavcodec.so.58]
0x0000000000000001 (NEEDED) Shared library: [libavformat.so.58]
0x0000000000000001 (NEEDED) Shared library: [libavutil.so.56]
0x0000000000000001 (NEEDED) Shared library: [libswresample.so.3]
0x0000000000000001 (NEEDED) Shared library: [libswscale.so.5]
0x0000000000000001 (NEEDED) Shared library: [libfmod.so.13]
0x0000000000000001 (NEEDED) Shared library: [libGLEW.so.2.1]
0x0000000000000001 (NEEDED) Shared library: [libz.so.1]
0x0000000000000001 (NEEDED) Shared library: [libSDL2-2.0.so.0]
0x0000000000000001 (NEEDED) Shared library: [libGL.so.1]
0x0000000000000001 (NEEDED) Shared library: [libstdc++.so.6]
0x0000000000000001 (NEEDED) Shared library: [libgcc_s.so.1]
0x0000000000000001 (NEEDED) Shared library: [libc.so.6]
</code></pre><p>Of the libraries listed, some I intend to bundle with the executable, while others I would assume to already be installed on the operating system:</p><ul><li>ffmpeg, fmod, GLEW, zlib, and SDL are all libraries I chose to use, so I will bundle them</li><li>OpenGL, stdc++, gcc, and clib are fundamental OS features that I&rsquo;d expect to be pre-installed by the OS</li></ul><p>Of course, this means I need to make sure the bundled libraries are in a spot the executable can find them. To reiterate, this is done by setting an &ldquo;rpath&rdquo; value that is the path to the bundled libraries.</p><h1 id=how-shared-library-names-are-chosen>How Shared Library Names are Chosen</h1><p>The library names that <code>readelf</code> outputs are baked into the executable at build time. How are those names determined?</p><p>The library name is pulled directly from the shared library itself. The value of the library&rsquo;s <code>SONAME</code> field is used. You can use <code>objdump</code> to see a shared library&rsquo;s <code>SONAME</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>objdump -p LIB_PATH <span class=p>|</span> grep SONAME
</span></span></code></pre></div><p>For example, here&rsquo;s what I see if I run <code>objdump -p libavcodec.so</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>SONAME libavcodec.so.58
</span></span></code></pre></div><p>You might wonder: why is the <code>SONAME</code> different from the file name? This relates to versioning strategies that are used by library maintainers. With this particular library, I actually have three files:</p><ul><li>libavcodec.so (symlink to actual file)</li><li>libavcodec.58.so (symlink to actual file)</li><li>libavcodec.58.91.100.so (actual file) (SONAME is libavcodec.58)</li></ul><p>Specifying an <code>SONAME</code> with the &ldquo;58&rdquo; major version number indicates that the program is expected to work with any &ldquo;58&rdquo; variant of the shared library. If an end-user wanted, they could use an updated minor or patch release version of the &ldquo;58&rdquo; library (perhaps with some bug fixes present) and it should still work. On the other hand, if major version &ldquo;59&rdquo; was installed, it would not be considered.</p><p>Depending on your use-case, it may be desirable or undesirable to deal with a library&rsquo;s version numbering when you bundle a shared library with your application. So, you may have a need to change the <code>SONAME</code> used by your executable.</p><h1 id=changing-shared-library-names>Changing Shared Library Names</h1><p>Let&rsquo;s say you have a shared library whose <code>SONAME</code> is incorrect or just not what you want it to be. Fortunately, you can change it with the <code>patchelf</code> tool:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>patchelf --set-soname NEW_SONAME LIB_PATH
</span></span></code></pre></div><p>You can set any <code>SONAME</code> you&rsquo;d like, but remember: this value will be embedded in the executable and used to locate the shared library at runtime. So this should be the name of a file that is bundled with your application!</p><h1 id=changing-loader-names>Changing Loader Names</h1><p>On the flipside, you may have an executable with an incorrect shared library name embedded within it. Perhaps the library&rsquo;s location changed or perhaps the value was errantly set. Fortunately, this can <em>also</em> be changed using <code>patchelf</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>patchelf --replace-needed OLD_NAME NEW_NAME EXE_PATH
</span></span></code></pre></div><p>In this case, you must specify the old and new names, so it acts like a find/replace. This is because there may be numerous library names listed in the executable, so you must specify exactly which one to change.</p><h1 id=verifying-loaded-libraries>Verifying Loaded Libraries</h1><p>After you&rsquo;ve built your executable, it can be helpful to verify that it&rsquo;s loading all its shared libraries from the locations you&rsquo;re expecting.</p><p>One simple way to do this is the <code>ldd</code> command, which outputs the paths to all shared libraries that the application will use. These paths are calculated on-the-fly, so the output may change each time you run it and as you install or uninstall libraries from your system.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>ldd EXE_PATH
</span></span></code></pre></div><h1 id=troubleshooting-loaded-libraries>Troubleshooting Loaded Libraries</h1><p>At runtime, you may run into problems with shared libraries not being loaded successfully, or perhaps you&rsquo;d like more output about the library load process. Running your application with a special flag lets you see all the details about which shared libraries are being loaded and which paths are being checked:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nv>LD_DEBUG</span><span class=o>=</span>libs EXE_PATH
</span></span></code></pre></div><h1 id=conclusion>Conclusion</h1><p>If you compare this post to my previous one about Mac dynamic libraries, you&rsquo;ll notice a lot of parallels. In some cases, all that&rsquo;s changed is the name of the tool used to perform a certain action. That being said, I think loading shared libraries on Linux is actually a bit simpler than it is on Mac!</p><p>I hope this post provides a simple and straightforward explanation of how you can wrangle shared libraries in your Linux applications!</p><div class=blog-tags><a href=https://kromenak.github.io//tags/linux/>Linux</a>&nbsp;
<a href=https://kromenak.github.io//tags/build/>Build</a>&nbsp;
<a href=https://kromenak.github.io//tags/libraries/>Libraries</a>&nbsp;</div></article><ul class="pager blog-pager"><li class=previous><a href=https://kromenak.github.io/post/web-building-and-hosting/ data-toggle=tooltip data-placement=top title="Building a Simple & Affordable Website">&larr; Previous Post</a></li></ul><div class=disqus-comments><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//clarkkromenaker.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=mailto:kromenak@gmail.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/kromenak title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://linkedin.com/in/clarkkromenaker title=LinkedIn><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a href title=RSS><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted">Clark Kromenaker
&nbsp;&bull;&nbsp;&copy;
2024</p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Powered by Hugo v0.133.1</a> &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous></script><script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://kromenak.github.io/js/main.js></script><script>renderMathInElement(document.body)</script></body></html>
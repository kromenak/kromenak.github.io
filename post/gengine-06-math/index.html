<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>G-Engine #6: Math Library - Clark Kromenaker</title>
<meta name=description content="After my post about 
rendering basics, I had a fairly underwhelming final result: a single triangle being rendered in 3D. But it&rsquo;s progress! My next goals are to do two seemingly simple things: move the virtual &ldquo;camera&rdquo; around my 3D environment to view the triangle from different perspectives, and move the triangle itself to different locations in 3D space.
If we were just writing some graphics library sample code, achieving those two goals would not be too tricky: we could just use some OpenGL convenience methods and objects that provide the math needed. However, if our goal is to build a full game engine, it is better to create our own mathematical constructs that lay the groundwork for 3D world features we&rsquo;ll want in the future, such as translation/rotation/scaling of objects, and parenting.
One of the first things I need to address is my lack of math library. This post will explore a basic useful math library for a 3D game engine. Future posts will build upon this math library core to add support for 3D vector math, matrices, quaternions, and more!"><meta name=author content="Clark Kromenaker"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Clark Kromenaker","url":"https:\/\/clarkkromenaker.com\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/clarkkromenaker.com\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/clarkkromenaker.com\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/clarkkromenaker.com\/post\/gengine-06-math\/","name":"G engine #6 math library"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Clark Kromenaker"},"headline":"G-Engine #6: Math Library","description":"After my post about rendering basics, I had a fairly underwhelming final result: a single triangle being rendered in 3D. But it\u0026rsquo;s progress! My next goals are to do two seemingly simple things: move the virtual \u0026ldquo;camera\u0026rdquo; around my 3D environment to view the triangle from different perspectives, and move the triangle itself to different locations in 3D space.\nIf we were just writing some graphics library sample code, achieving those two goals would not be too tricky: we could just use some OpenGL convenience methods and objects that provide the math needed. However, if our goal is to build a full game engine, it is better to create our own mathematical constructs that lay the groundwork for 3D world features we\u0026rsquo;ll want in the future, such as translation\/rotation\/scaling of objects, and parenting.\nOne of the first things I need to address is my lack of math library. This post will explore a basic useful math library for a 3D game engine. Future posts will build upon this math library core to add support for 3D vector math, matrices, quaternions, and more!\n","inLanguage":"en","wordCount":1921,"datePublished":"2019-11-27T00:00:00","dateModified":"2019-11-27T00:00:00","image":"https:\/\/clarkkromenaker.com\/img\/avatar-icon.png","keywords":["G-Engine, C\u002b\u002b"],"mainEntityOfPage":"https:\/\/clarkkromenaker.com\/post\/gengine-06-math\/","publisher":{"@type":"Organization","name":"https:\/\/clarkkromenaker.com\/","logo":{"@type":"ImageObject","url":"https:\/\/clarkkromenaker.com\/img\/avatar-icon.png","height":60,"width":60}}}</script><meta property="og:title" content="G-Engine #6: Math Library"><meta property="og:description" content="After my post about 
rendering basics, I had a fairly underwhelming final result: a single triangle being rendered in 3D. But it&rsquo;s progress! My next goals are to do two seemingly simple things: move the virtual &ldquo;camera&rdquo; around my 3D environment to view the triangle from different perspectives, and move the triangle itself to different locations in 3D space.
If we were just writing some graphics library sample code, achieving those two goals would not be too tricky: we could just use some OpenGL convenience methods and objects that provide the math needed. However, if our goal is to build a full game engine, it is better to create our own mathematical constructs that lay the groundwork for 3D world features we&rsquo;ll want in the future, such as translation/rotation/scaling of objects, and parenting.
One of the first things I need to address is my lack of math library. This post will explore a basic useful math library for a 3D game engine. Future posts will build upon this math library core to add support for 3D vector math, matrices, quaternions, and more!"><meta property="og:image" content="https://clarkkromenaker.com/img/avatar-icon.png"><meta property="og:url" content="https://clarkkromenaker.com/post/gengine-06-math/"><meta property="og:type" content="website"><meta property="og:site_name" content="Clark Kromenaker"><meta name=twitter:title content="G-Engine #6: Math Library"><meta name=twitter:description content="After my post about 
rendering basics, I had a fairly underwhelming final result: a single triangle being rendered in 3D. But it&rsquo;s progress! My next goals are to do two seemingly simple things: â€¦"><meta name=twitter:image content="https://clarkkromenaker.com/img/avatar-icon.png"><meta name=twitter:card content="summary_large_image"><link href=https://clarkkromenaker.com/img/favicon.ico rel=icon type=image/x-icon><meta name=generator content="Hugo 0.133.1"><link rel=alternate href=https://clarkkromenaker.com/index.xml type=application/rss+xml title="Clark Kromenaker"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://clarkkromenaker.com/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://clarkkromenaker.com/css/syntax.css><link rel=stylesheet href=https://clarkkromenaker.com/css/codeblock.css><link rel=stylesheet href=https://clarkkromenaker.com//css/portfolio.css><link rel=stylesheet href=https://clarkkromenaker.com//css/misc.css><link rel=stylesheet href=https://clarkkromenaker.com//css/overrides.css><script src=https://clarkkromenaker.com//js/darkModeToggle.js></script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://clarkkromenaker.com/>Clark Kromenaker</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Blog href=/>Blog</a></li><li><a title=Portfolio href=/portfolio>Portfolio</a></li><li><a title=About href=/about>About</a></li><li><a title=Tags href=/tags>Tags</a></li><li class=navlinks-container id=dark-mode-toggle><a href=javascript:toggleColorScheme();><i id=icon-sun class="fas fa-sun"></i>
<i id=icon-moon class="fas fa-moon"></i></a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title="Clark Kromenaker" href=https://clarkkromenaker.com/><img class=avatar-img src=https://clarkkromenaker.com/img/avatar-icon.png alt="Clark Kromenaker"></a></div></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>G-Engine #6: Math Library</h1><span class=post-meta><i class=fas></i>Posted on November 27, 2019</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>After my post about
<a href=/post/gengine-04-rendering>rendering basics</a>, I had a fairly underwhelming final result: a single triangle being rendered in 3D. But it&rsquo;s progress! My next goals are to do two seemingly simple things: move the virtual &ldquo;camera&rdquo; around my 3D environment to view the triangle from different perspectives, and move the triangle itself to different locations in 3D space.</p><p>If we were just writing some graphics library sample code, achieving those two goals would not be too tricky: we could just use some OpenGL convenience methods and objects that provide the math needed. However, if our goal is to build a full game engine, it is better to create our own mathematical constructs that lay the groundwork for 3D world features we&rsquo;ll want in the future, such as translation/rotation/scaling of objects, and parenting.</p><p>One of the first things I need to address is my lack of math library. This post will explore a basic useful math library for a 3D game engine. Future posts will build upon this math library core to add support for 3D vector math, matrices, quaternions, and more!</p><h1 id=why-do-we-need-a-math-library>Why Do We Need a Math Library?</h1><p>C++ has built-in support for many mathematical operators using both integer and floating point numbers. With <code>int</code>, <code>float</code>, and <code>double</code>, we can add, subtract, divide, and multiply with ease.</p><p>The C++ Standard Library also provides many useful math functions - things like min, max, sine, cosine, tangent, absolute value, round, ceiling, floor, etc.</p><p>However, we <em>still</em> need our own math library! Our math library will provide a number of features that C++ alone does not provide:</p><ul><li>A reliable way to check equality of floating-point numbers.</li><li>Wrappers around C++ Standard Library functions and additional convenience functions.</li><li>Classes representing 3D math and geometrical objects, like <code>Vectors</code>, <code>Matrices</code> and <code>Quaternions</code>.</li></ul><p>This post will focus on the first two points - we&rsquo;ll discuss Vectors, Matrices, and other math concepts in dedicated posts.</p><p>You may be able to find a free or open source C++ math library on Github, and using that could save you a lot of time at this point. But again, we want to learn, so we&rsquo;ll write it ourselves.</p><h1 id=testing-the-math-library>Testing the Math Library</h1><p>As you write a math library, it&rsquo;ll be extremely helpful to have some way to verify whether your code is correct or not.</p><p>If you write a lot of code to render a 3D object, but it doesn&rsquo;t show up on screen, how do you know where the problem is? At this early stage in development, with very little visual feedback and few debug tools, it can be difficult to troubleshoot such issues. Problems can arise due to bad data, incorrect usage of graphics APIs, or incorrect implementations of math functions.</p><p>One thing we can do to rule out math bugs is write some <strong>unit tests</strong> to verify that our math functions and classes are working correctly.</p><p>Finding and evaluating a unit testing framework could be a whole blog post itself! After a bit of research, I decided on a unit testing framework called
<a href=https://github.com/catchorg/Catch2 target=_blank>Catch</a>. Catch is very simple to integrate and run, and it&rsquo;s cross-platform and cross-IDE.</p><p>For example, we could write a simple math unit test like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>// File MathTests.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#include</span> <span class=cpf>&#34;catch.hh&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;Math.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=n>TEST_CASE</span><span class=p>(</span><span class=s>&#34;Absolute value works&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>REQUIRE</span><span class=p>(</span><span class=n>Math</span><span class=o>::</span><span class=n>Abs</span><span class=p>(</span><span class=o>-</span><span class=mf>5.0f</span><span class=p>)</span> <span class=o>==</span> <span class=mf>5.0f</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Using this structure, we can write simple to extremely complex tests to exercise our implementations of various math functions. Math libraries are one instance where unit tests are extremely well suited: a math function usually has one or more inputs and an output. Unit tests are extremely good for verifying that all inputs produce the expected outputs.</p><p>I keep my tests isolated from other source code files by putting them in their own <code>Tests</code> directory. In Xcode, I also created a separate &ldquo;Target&rdquo; for running tests. This allows me to choose between the &ldquo;run my game&rdquo; target and the &ldquo;run my tests&rdquo; target. This also allows me to only include my &ldquo;test&rdquo; .cpp files in the &ldquo;test&rdquo; target.</p><h1 id=reliable-floating-point-number-comparison>Reliable Floating-Point Number Comparison</h1><p>Comparing numbers is supposed to be easy, and computers are supposed to be good at it. But not so fast! When numbers have fractional parts, you encounter some unexpected challenges:</p><ul><li>Floating-point numbers are stored in 32-bits, and those bits may not be able to accurately represent some fractional numbers. For example <code>0.2</code> can&rsquo;t be represented exactly as a floating point number!</li><li>Performing many floating-point math operations may result in rounding error, since intermediate or final values may not be represented exactly.</li><li>Numbers that are equal may not be <em>exactly</em> equal due to differences in precision. For example, is <code>0.24583923</code> equal to <code>0.245839230000001</code>? They are very close, but a computer comparing the two numbers would say that they are not equal.</li></ul><p><a href=https://0.30000000000000004.com target=_blank>https://0.30000000000000004.com</a> highlights a fun example in a variety of programming languages where a simple floating-point calculation yields unanticipated results.</p><p>Here&rsquo;s another example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>TEST_CASE</span><span class=p>(</span><span class=s>&#34;Floating-point comparison works&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>float</span> <span class=n>f1</span> <span class=o>=</span> <span class=mf>4.7f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>float</span> <span class=n>f2</span> <span class=o>=</span> <span class=mf>3.14f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>float</span> <span class=n>result</span> <span class=o>=</span> <span class=n>f1</span> <span class=o>/</span> <span class=n>f2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>REQUIRE</span><span class=p>(</span><span class=n>result</span> <span class=o>==</span> <span class=mf>1.4968152866f</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>If you perform <code>4.7 / 3.14</code> in a calculator, you&rsquo;ll likely get a result at least close to the number we are checking against. But it might be slightly different! The above test will probably <strong>FAIL</strong> on your machine. In my compiler, the resulting digits are correct, but the calculated result is less precise (1.4968152f vs. 1.4968152866f).</p><p>Direct comparison of floating-point numbers in this way is dangerous, and it actually generates a warning or error in some languages. The warning is warranted - this is likely to produce frustrating buggy behavior.</p><p>Think of it as your computer being a bit too pedantic; you say &ldquo;if this variable equals 0, run this code,&rdquo; but your computer says &ldquo;ahhhh, oooo, so close - but 0.0000000000001 does not equal 0; sorry!&rdquo;</p><p><img src="https://media1.tenor.com/images/2df998371c24c21ba3b8bdb06cf1e3b4/tenor.gif?itemid=4575092#center" alt="You&rsquo;re not wrong&mldr;"></p><p>The common solution to this problem is to avoid performing exact-equality checks between floating-point numbers. Instead, we can check whether two values are &ldquo;close enough&rdquo; to be considered equal. In the above example, surely those two floating-point numbers are close enough to be considered equal? It depends on your problem domain, but for video games, it&rsquo;s likely fine.</p><p>So, we can write a function that does this for us!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>// Math.h
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#pragma once
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cmath&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>Math</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Dictates that floating-point numbers within 0.000001 units are equal to one another.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>static</span> <span class=k>const</span> <span class=kt>float</span> <span class=n>kEpsilon</span> <span class=o>=</span> <span class=mf>1.0e-6</span><span class=n>f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>IsZero</span><span class=p>(</span><span class=kt>float</span> <span class=n>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>fabsf</span><span class=p>(</span><span class=n>val</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>kEpsilon</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>inline</span> <span class=kt>bool</span> <span class=nf>AreEqual</span><span class=p>(</span><span class=kt>float</span> <span class=n>a</span><span class=p>,</span> <span class=kt>float</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>IsZero</span><span class=p>(</span><span class=n>a</span> <span class=o>-</span> <span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>First, we define a value, <code>kEpsilon</code>, which specifies our choice about how close two numbers need to be for us to consider them equal. In this case, I&rsquo;m saying that if two numbers are within 0.000001 of one another, they are considered to be the same number for equality check purposes. (Why <code>kEpsilon</code>? The <code>k</code> is an indicator for a &ldquo;constant&rdquo;, and
<a href=https://en.wikipedia.org/wiki/Machine_epsilon target=_blank>Epsilon</a> is the conventional name given to such a value.)</p><p>Next, we create a function called <code>IsZero</code>, which determines whether a floating-point value is &ldquo;close enough&rdquo; to be considered zero. Given our current <code>kEpsilon</code> value, 0.00001f is not zero, but 0.000000001f would be.</p><p>Finally, we can define a function, <code>AreEqual</code> that determines whether two <code>float</code> numbers are close enough to be considered equal. By subtracting the two numbers, we get the difference between the two. If that difference is close enough to zero (aka, less than <code>kEpsilon</code>), we say they are equal.</p><p>I&rsquo;ve created a file called <code>Math.h</code>, which contains a namespace <code>Math</code>, to hold general-purpose math functions. Inside, I have a number of <code>inline</code> functions. Note that the <code>inline</code> keyword is required to have a function definition in the header file like this when the functions aren&rsquo;t in a <code>class</code>.</p><p>I can update my floating-point comparison test, which now works as expected:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>TEST_CASE</span><span class=p>(</span><span class=s>&#34;Floating-point comparison works&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>float</span> <span class=n>f1</span> <span class=o>=</span> <span class=mf>4.7f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>float</span> <span class=n>f2</span> <span class=o>=</span> <span class=mf>3.14f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>float</span> <span class=n>result</span> <span class=o>=</span> <span class=n>f1</span> <span class=o>/</span> <span class=n>f2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>REQUIRE</span><span class=p>(</span><span class=n>Math</span><span class=o>::</span><span class=n>AreEqual</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=mf>1.4968152866f</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h1 id=c-math-wrappers>C++ Math Wrappers</h1><p>In addition to these floating-point comparison functions, I also added a number of &ldquo;wrapper&rdquo; functions in the <code>Math.h</code> header. These wrapper functions simply call the corresponding function in the C++ Standard Library.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>float</span> <span class=nf>Floor</span><span class=p>(</span><span class=kt>float</span> <span class=n>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>floor</span><span class=p>(</span><span class=n>val</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>float</span> <span class=nf>Ceil</span><span class=p>(</span><span class=kt>float</span> <span class=n>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>ceil</span><span class=p>(</span><span class=n>val</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>float</span> <span class=nf>Round</span><span class=p>(</span><span class=kt>float</span> <span class=n>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>round</span><span class=p>(</span><span class=n>val</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Etc.
</span></span></span></code></pre></div><p>Why do this?</p><p>For one, let&rsquo;s suppose I have sprinkled my engine code with hundreds of calls to <code>std::floor</code>, but I then realize there&rsquo;s some issue with that function, or I want to start using a more efficient implementation. Or maybe I just want to output a log each time that function is called while I&rsquo;m debugging an issue. It would be quite tedious to augment or replace all my calls to that function! By creating simple wrappers around these functions, I can easily replace or modify the implementation without having to modify other spots in my code.</p><p>A classic example of this is &ldquo;inverse square root.&rdquo; Taking square roots is fairly expensive compared to other math functions, but there was a time in the 90s when it was <em>TOO</em> expensive. Quake 3 famously used an
<a href=https://en.wikipedia.org/wiki/Fast_inverse_square_root target=_blank>optimized version of inverse square root</a>. Such wrapper functions make it easy for us to tweak, modify, or completely change our math code in one place. You could start by using a simple <code>1.0f / std::sqrt(x)</code>, but if you find you need faster code, you could switch out the implementation for a faster one.</p><p>Since these functions are so small (for now) and marked as <code>inline</code>, they will likely be inlined by the compiler. This means that wrapping these functions shouldn&rsquo;t add any performance overhead.</p><p>My <code>Math</code> namespace currently has these C++ Standard Library wrappers:</p><ul><li>Sqrt (std::sqrt)</li><li>Pow (std::pow)</li><li>Mod (std::fmod)</li><li>Sin (std::sinf)</li><li>Cos (std::cosf)</li><li>Tan (std::tanf)</li><li>Asin (std::asinf)</li><li>Acos (std::acosf)</li><li>Atan (std::atanf)</li><li>Atan2 (std::atan2)</li><li>Floor (std::floor)</li><li>Ceil (std::ceil)</li><li>Round (std::round)</li><li>Min (std::min)</li><li>Max (std::max)</li><li>Min (std::fmin)</li><li>Max (std::fmax)</li><li>Abs (std::abs)</li></ul><h1 id=c-custom-math-functions>C++ Custom Math Functions</h1><p>In addition to the wrapper functions, you sometimes need to define your own custom functions. The C++ Standard Library has a lot of useful math utilities, but it doesn&rsquo;t have them all.</p><p>Game engines often need to deal with rotations in both radians and degrees. We can define some useful constants and functions that&rsquo;ll make that a bit easier in the future:</p><ul><li>kPi (~3.14f; equates to 180 degrees)</li><li>k2Pi (~6.28f; equates to 360 degrees)</li><li>kPiOver2 (~1.57f; equates to 90 degrees)</li><li>kPiOver4 (~0.79f; equates to 45 degrees)</li><li>ToDegrees (converts radians to degrees)</li><li>ToRadians (converts degrees to radians)</li></ul><p>Additionally, there are variations on Standard Library functions that we may want to define for convenience or performance:</p><ul><li>InvSqrt</li><li>PowBase2 (assumes base 2 for more efficient implementation)</li><li>FloorToInt</li><li>CeilToInt</li><li>RoundToInt</li><li>Clamp</li></ul><p>Finally, you may find that you need completely new math functions, which you can also add here:</p><ul><li>Lerp (linear interpolation function)</li></ul><p>Over time, I&rsquo;ll no doubt add more wrapper and convenience functions to <code>Math</code>. You can find the current iteration
<a href=https://github.com/kromenak/gengine/blob/master/Source/Math/GMath.h target=_blank>here</a>.</p><h1 id=conclusion>Conclusion</h1><p>The math library is an important, albeit not particularly glamorous addition to a game engine. Since C++ does not provide any out-of-the-box floating-point math comparison utilities, it&rsquo;s easy to overlook the issue and get into trouble later. Additionally, planning ahead with wrapper functions keeps our math logic organized, centralized, and easy to modify.</p><p>Though we&rsquo;ve only created a single <code>Math</code> namespace, our math library will grow over time to include many standalone classes as well. We have only scratched the surface!</p><p>Some of the math functions added here will be useful as we implement foundational 3D math classes in upcoming posts: Vectors and Matrices.</p><div class=blog-tags><a href=https://clarkkromenaker.com//tags/g-engine/>G-Engine</a>&nbsp;
<a href=https://clarkkromenaker.com//tags/c++/>C++</a>&nbsp;</div></article><ul class="pager blog-pager"><li class=previous><a href=https://clarkkromenaker.com/post/gengine-05-asset-types/ data-toggle=tooltip data-placement=top title="G-Engine #5: GK3 Assets Overview">&larr; Previous Post</a></li><li class=next><a href=https://clarkkromenaker.com/post/gengine-07-vectors/ data-toggle=tooltip data-placement=top title="G-Engine #7: Vectors">Next Post &rarr;</a></li></ul><div class=disqus-comments><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//clarkkromenaker.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=mailto:kromenak@gmail.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/kromenak title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://linkedin.com/in/clarkkromenaker title=LinkedIn><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a href title=RSS><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted">Clark Kromenaker
&nbsp;&bull;&nbsp;&copy;
2025</p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Powered by Hugo v0.133.1</a> &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous></script><script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://clarkkromenaker.com/js/main.js></script><script>renderMathInElement(document.body)</script></body></html>